(()=>{"use strict";var e="";const t=document.querySelector("#card-template")?.content;function o(e,o,r,n){if(!t)return;const i=t.cloneNode(!0).querySelector(".card"),c=i.querySelector(".card__image"),a=i.querySelector(".card__title"),u=i.querySelector(".card__delete-button"),p=i.querySelector(".card__like-button");return c.src=e.link,c.alt=e.name,a.textContent=e.name,p.addEventListener("click",(()=>r(p))),u.addEventListener("click",(()=>n(i))),c.addEventListener("click",(()=>o(e))),i}function r(e){e&&!e.classList.contains("popup_is-opened")&&(e.classList.add("popup_is-opened"),document.addEventListener("keydown",i))}function n(e){e&&e.classList.contains("popup_is-opened")&&(e.classList.add("popup_fade-out"),requestAnimationFrame((()=>{setTimeout((()=>{e.classList.remove("popup_is-opened","popup_fade-out"),document.removeEventListener("keydown",i)}),300)})))}function i(e){const t=document.querySelector(".popup_is-opened");"Escape"===e.key&&t&&n(t)}function c(e){e.target.classList.contains("popup")&&n(e.target)}function a(e,t,o,r){const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)}function u(e,t,o){const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""}function p(e,t,o){e.some((e=>!e.validity.valid||e.classList.contains(o.inputErrorClass)))?(t.classList.add(o.inactiveButtonClass),t.disabled=!0):(t.classList.remove(o.inactiveButtonClass),t.disabled=!1)}function s(e){e.querySelectorAll(".popup__input-error").forEach((e=>{e.textContent=""})),e.querySelectorAll(".popup__input").forEach((e=>{e.classList.remove("popup__input_type_error")}))}const l=e+"images/logo.svg",d=e+"images/avatar.jpg",_="https://mesto.nomoreparties.co/v1/wff-cohort-36",m="1edbed4a-9f7a-4d96-b1b9-f5fbaa1e4e60";function y(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}function f(e){return fetch(`${_}/cards/${e}/likes`,{method:"PUT",headers:{Authorization:m,"Content-Type":"application/json"}}).then(y)}function h(e){return fetch(`${_}/cards/${e}/likes`,{method:"DELETE",headers:{Authorization:m,"Content-Type":"application/json"}}).then(y)}document.querySelector(".header__logo").src=l,document.querySelector(".profile__image").style.backgroundImage=`url(${d})`;const S={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},v=document.querySelector(".places__list"),q={addCard:document.querySelector(".popup_type_new-card"),editProfile:document.querySelector(".popup_type_edit"),image:document.querySelector(".popup_type_image")},C=document.querySelector(".profile__edit-button"),g=document.querySelector(".profile__add-button"),b=document.querySelector(".profile__title"),E=document.querySelector(".profile__description");function L(e,t,o){(o?h:f)(t).then((t=>{e.classList.toggle("card__like-button_is-active"),e.nextElementSibling.textContent=t.likes.length})).catch((e=>{console.error("Ошибка при обработке лайка:",e)}))}function k(e,t){(function(e){return fetch(`${_}/cards/${e}`,{method:"DELETE",headers:{Authorization:m,"Content-Type":"application/json"}}).then(y)})(t).then((()=>{e.remove()})).catch((e=>{console.error("Ошибка при удалении карточки:",e)}))}function A(e){const t=q.image.querySelector(".popup__image"),o=q.image.querySelector(".popup__caption");t.src=e.link,t.alt=e.name,o.textContent=e.name,r(q.image)}C?.addEventListener("click",(()=>{const e=q.editProfile.querySelector(".popup__form"),t=e.querySelector(".popup__input_type_name"),o=e.querySelector(".popup__input_type_description");t.value=b.textContent,o.value=E.textContent,s(e),r(q.editProfile)})),g?.addEventListener("click",(()=>{const e=q.addCard.querySelector(".popup__form");e.reset(),s(e),r(q.addCard)})),document.querySelectorAll(".popup").forEach((e=>{e.addEventListener("click",c)})),document.querySelectorAll(".popup__close").forEach((e=>{e.addEventListener("click",(e=>{n(e.target.closest(".popup"))}))})),q.editProfile.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();const t=e.target,o=t.querySelector(".popup__input_type_name"),r=t.querySelector(".popup__input_type_description");var i,c;(i=o.value,c=r.value,fetch(`${_}/users/me`,{method:"PATCH",headers:{Authorization:m,"Content-Type":"application/json"},body:JSON.stringify({name:i,about:c})}).then(y)).then((e=>{b.textContent=e.name,E.textContent=e.about,n(q.editProfile)})).catch((e=>{console.error("Ошибка при обновлении профиля:",e)}))})),q.addCard.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();const t=e.target,r=t.querySelector(".popup__input_type_card-name"),i=t.querySelector(".popup__input_type_url");var c,a;(c=r.value,a=i.value,fetch(`${_}/cards`,{method:"POST",headers:{Authorization:m,"Content-Type":"application/json"},body:JSON.stringify({name:c,link:a})}).then(y)).then((e=>{const r=o(e,A,L,k);v.prepend(r),function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);e.reset(),o.forEach((o=>{u(e,o,t)})),r.disabled=!0,r.classList.add(t.inactiveButtonClass)}(t,S),n(q.addCard)})).catch((e=>{console.error("Ошибка при добавлении карточки:",e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{!function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);p(o,r,t),o.forEach((n=>{n.addEventListener("input",(()=>{!function(e,t,o){const r=t.value.length,n=t.hasAttribute("minlength")?t.minLength:0,i=t.hasAttribute("maxlength")?t.maxLength:1e3;t.value?r<n?a(e,t,`Минимум ${n} символов. Сейчас ${r} символов.`,o):r>i?a(e,t,`Максимум ${i} символов`,o):t.validity.valid?u(e,t,o):a(e,t,t.validationMessage,o):a(e,t,"Вы пропустили это поле",o)}(e,n,t),p(o,r,t)}))}))}(t,e)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"}),Promise.all([fetch(`${_}/users/me`,{method:"GET",headers:{Authorization:m,"Content-Type":"application/json"}}).then(y),fetch(`${_}/cards`,{method:"GET",headers:{Authorization:m,"Content-Type":"application/json"}}).then(y)]).then((e=>{let[t,r]=e;b.textContent=t.name,E.textContent=t.about,document.querySelector(".profile__image").style.backgroundImage=`url(${t.avatar})`,function(e){e.forEach((e=>{const t=o(e,A,L,k);v.append(t)}))}(r)})).catch((e=>{console.error("Ошибка при загрузке данных:",e)}))})();