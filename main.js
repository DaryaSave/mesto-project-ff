(()=>{"use strict";var e="";const t="https://mesto.nomoreparties.co/v1/wff-cohort-36",r="1edbed4a-9f7a-4d96-b1b9-f5fbaa1e4e60";function o(e){return e.ok?e.json():Promise.reject(new Error(`Ошибка: ${e.status}`))}function n(e){return fetch(`${t}/cards/${e}/likes`,{method:"PUT",headers:{Authorization:r,"Content-Type":"application/json"}}).then(o)}function a(e){return fetch(`${t}/cards/${e}/likes`,{method:"DELETE",headers:{Authorization:r,"Content-Type":"application/json"}}).then(o)}const c=document.querySelector("#card-template")?.content;function i(e,t,r,o){return(t?a:n)(e).then((e=>(r.classList.toggle("card__like-button_is-active"),o.textContent=e.likes.length,e))).catch((e=>{throw console.error("Ошибка при обработке лайка:",e),e}))}function s(e,n){return function(e){return fetch(`${t}/cards/${e}`,{method:"DELETE",headers:{Authorization:r,"Content-Type":"application/json"}}).then(o)}(e).then((()=>{n.remove()})).catch((e=>{throw console.error("Ошибка при удалении карточки:",e),e}))}function u(e,t,r,o){if(!c)return console.error("Шаблон карточки не найден"),null;const n=c.cloneNode(!0).querySelector(".card");if(n.dataset.cardId=e._id,!n)return console.error("Элемент карточки не найден в шаблоне"),null;const a=n.querySelector(".card__image"),i=n.querySelector(".card__title"),s=n.querySelector(".card__delete-button"),u=n.querySelector(".card__like-button"),l=n.querySelector(".card__like-container .card__like-count");return a&&i&&s&&u&&l?(a.src=e.link||"",a.alt=e.name||"",i.textContent=e.name||"",l.textContent=e.likes?e.likes.length:0,e.likes&&e.currentUserId&&e.likes.some((t=>t._id===e.currentUserId))&&u.classList.add("card__like-button_is-active"),u.addEventListener("click",(()=>{const t=u.classList.contains("card__like-button_is-active");r(e._id,t,u,l)})),e.owner._id!==e.currentUserId?s.remove():s.addEventListener("click",(()=>o(e._id,n))),a.addEventListener("click",(()=>t(e.link,e.name))),n):(console.error("Не найдены основные элементы карточки"),null)}function l(e){e&&!e.classList.contains("popup_is-opened")&&(e.classList.add("popup_is-opened"),document.addEventListener("keydown",d))}function p(e){e&&e.classList.contains("popup_is-opened")&&(e.classList.add("popup_fade-out"),requestAnimationFrame((()=>{setTimeout((()=>{e.classList.remove("popup_is-opened","popup_fade-out"),document.removeEventListener("keydown",d)}),300)})))}function d(e){const t=document.querySelector(".popup_is-opened");"Escape"===e.key&&t&&p(t)}function _(e){e.target.classList.contains("popup")&&p(e.target)}const m=(e,t,r)=>{const o=e.querySelector(`#${t.name}-error`);o&&(t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent="")},y=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(r.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},f=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach((r=>{m(e,r,t)})),o.classList.add(t.inactiveButtonClass),o.disabled=!0},h=e+"images/logo.svg",v=e+"images/avatar.jpg";document.querySelector(".header__logo").src=h,document.querySelector(".profile__image").style.backgroundImage=`url(${v})`;const S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"},q=document.querySelector(".places__list"),g={addCard:document.querySelector(".popup_type_new-card"),editProfile:document.querySelector(".popup_type_edit"),image:document.querySelector(".popup_type_image"),avatar:document.querySelector(".popup_type_avatar")},C=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__image"),L=document.querySelector(".profile__image");if(!L.querySelector(".profile__edit-icon")){const e=document.createElement("span");e.classList.add("profile__edit-icon"),L.append(e)}L.style.backgroundImage=`url(${v})`;const k=document.querySelector(".profile__title"),A=document.querySelector(".profile__description");let $;function T(e,t,r){e.textContent=t?"Сохранение...":r}function x(e,t){const r=g.image.querySelector(".popup__image"),o=g.image.querySelector(".popup__caption");r.src=e,r.alt=t,o.textContent=t,l(g.image)}C?.addEventListener("click",(()=>{const e=g.editProfile.querySelector(".popup__form"),t=e.querySelector(".popup__input_type_name"),r=e.querySelector(".popup__input_type_description");t.value=k.textContent.trim(),r.value=A.textContent.trim(),f(e,S),l(g.editProfile)})),b?.addEventListener("click",(()=>{const e=g.addCard.querySelector(".popup__form");e.reset(),f(e,S),l(g.addCard)})),E?.addEventListener("click",(()=>{const e=g.avatar.querySelector(".popup__form");e.reset(),f(e,S),l(g.avatar)})),document.querySelectorAll(".popup").forEach((e=>{e.addEventListener("click",_)})),document.querySelectorAll(".popup__close").forEach((e=>{e.addEventListener("click",(e=>{p(e.target.closest(".popup"))}))})),g.editProfile.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();const n=e.target.querySelector(S.submitButtonSelector),a=n.textContent;T(n,!0,a);const c=e.target,i=c.querySelector(".popup__input_type_name"),s=c.querySelector(".popup__input_type_description");var u,l;(u=i.value,l=s.value,fetch(`${t}/users/me`,{method:"PATCH",headers:{Authorization:r,"Content-Type":"application/json"},body:JSON.stringify({name:u,about:l})}).then(o)).then((e=>{k.textContent=e.name,A.textContent=e.about,p(g.editProfile)})).catch((e=>{console.error("Ошибка при обновлении профиля:",e)})).finally((()=>T(n,!1,a)))})),g.addCard.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();const n=e.target.querySelector(S.submitButtonSelector),a=n.textContent;T(n,!0,a);const c=e.target,l=c.querySelector(".popup__input_type_card-name"),d=c.querySelector(".popup__input_type_url");var _,m;(_=l.value,m=d.value,fetch(`${t}/cards`,{method:"POST",headers:{Authorization:r,"Content-Type":"application/json"},body:JSON.stringify({name:_,link:m})}).then(o)).then((e=>{const t=u({...e,currentUserId:$},x,i,s);q.prepend(t),((e,t)=>{e.reset(),f(e,t)})(c,S),p(g.addCard)})).catch((e=>{console.error("Ошибка при добавлении карточки:",e)})).finally((()=>T(n,!1,a)))})),g.avatar.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();const n=e.target.querySelector(S.submitButtonSelector),a=n.textContent;T(n,!0,a);var c;(c=e.target.querySelector(".popup__input_type_avatar-url").value,fetch(`${t}/users/me/avatar`,{method:"PATCH",headers:{Authorization:r,"Content-Type":"application/json"},body:JSON.stringify({avatar:c})}).then(o)).then((e=>{document.querySelector(".profile__image").style.backgroundImage=`url(${e.avatar})`,p(g.avatar)})).catch((e=>{console.error("Ошибка при обновлении аватара:",e)})).finally((()=>T(n,!1,a)))})),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{t.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);y(r,o,t),r.forEach((n=>{n.addEventListener("input",(()=>{((e,t,r)=>{if(t.setCustomValidity(""),t.validity.valueMissing){const e=t.dataset.errorRequired||"Поле обязательное";t.setCustomValidity(e)}else if(t.validity.typeMismatch){const e=t.dataset.errorUrl||"Поле содержит именно URL в корректном формате";t.setCustomValidity(e)}else t.validity.patternMismatch&&t.dataset.errorMessage&&t.setCustomValidity(t.dataset.errorMessage);t.checkValidity()?m(e,t,r):((e,t,r,o)=>{const n=e.querySelector(`#${t.name}-error`);n&&(t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass))})(e,t,t.validationMessage,r)})(e,n,t),y(r,o,t)}))}))})(t,e)}))})(S),Promise.all([fetch(`${t}/users/me`,{method:"GET",headers:{Authorization:r,"Content-Type":"application/json"}}).then(o),fetch(`${t}/cards`,{method:"GET",headers:{Authorization:r,"Content-Type":"application/json"}}).then(o)]).then((e=>{let[t,r]=e;$=t._id,k.textContent=t.name,A.textContent=t.about,document.querySelector(".profile__image").style.backgroundImage=`url(${t.avatar})`,function(e){e.forEach((e=>{const t=u({...e,currentUserId:$},x,i,s);q.append(t)}))}(r)})).catch((e=>{console.error("Ошибка при загрузке данных:",e)}))})();