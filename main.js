(()=>{"use strict";var e="";const t=document.querySelector("#card-template")?.content;function o(e,o,r,n){if(!t)return;const c=t.cloneNode(!0).querySelector(".card"),u=c.querySelector(".card__image"),a=c.querySelector(".card__title"),p=c.querySelector(".card__delete-button"),i=c.querySelector(".card__like-button");return u.src=e.link,u.alt=e.name,a.textContent=e.name,i.addEventListener("click",(()=>r(i))),p.addEventListener("click",(()=>n(c))),u.addEventListener("click",(()=>o(e))),c}function r(e){e&&!e.classList.contains("popup_is-opened")&&(e.classList.add("popup_is-opened"),document.addEventListener("keydown",c))}function n(e){e&&e.classList.contains("popup_is-opened")&&(e.classList.add("popup_fade-out"),requestAnimationFrame((()=>{setTimeout((()=>{e.classList.remove("popup_is-opened","popup_fade-out"),document.removeEventListener("keydown",c)}),300)})))}function c(e){const t=document.querySelector(".popup_is-opened");"Escape"===e.key&&t&&n(t)}function u(e){e.target.classList.contains("popup")&&n(e.target)}function a(e,t,o,r){const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)}function p(e,t,o){const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""}function i(e,t,o){e.some((e=>!e.validity.valid||e.classList.contains(o.inputErrorClass)))?(t.classList.add(o.inactiveButtonClass),t.disabled=!0):(t.classList.remove(o.inactiveButtonClass),t.disabled=!1)}function s(e){e.querySelectorAll(".popup__input-error").forEach((e=>{e.textContent=""})),e.querySelectorAll(".popup__input").forEach((e=>{e.classList.remove("popup__input_type_error")}))}const l=document.querySelector(".popup_type_delete");l.querySelector(".popup__button_confirm"),l.querySelector(".popup__button_cancel");const d=e+"images/logo.svg",_=e+"images/avatar.jpg",m={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-36",headers:{authorization:"1edbed4a-9f7a-4d96-b1b9-f5fbaa1e4e60","Content-Type":"application/json"}};function y(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}document.querySelector(".header__logo").src=d,document.querySelector(".profile__image").style.backgroundImage=`url(${_})`;const f={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},S=document.querySelector(".places__list"),h={addCard:document.querySelector(".popup_type_new-card"),editProfile:document.querySelector(".popup_type_edit"),image:document.querySelector(".popup_type_image"),confirmDelete:document.querySelector(".popup_type_confirm-delete")},v=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),b=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),C=document.querySelector(".profile__image");let L,E;function k(e){const t=h.image.querySelector(".popup__image"),o=h.image.querySelector(".popup__caption");t.src=e.link,t.alt=e.name,o.textContent=e.name,r(h.image)}function A(e){E=e,r(h.confirmDelete)}v?.addEventListener("click",(()=>{const e=h.editProfile.querySelector(".popup__form"),t=e.querySelector(".popup__input_type_name"),o=e.querySelector(".popup__input_type_description");t.value=b.textContent,o.value=g.textContent,s(e),r(h.editProfile)})),q?.addEventListener("click",(()=>{const e=h.addCard.querySelector(".popup__form");e.reset(),s(e),r(h.addCard)})),document.querySelectorAll(".popup").forEach((e=>{e.addEventListener("click",u)})),document.querySelectorAll(".popup__close").forEach((e=>{e.addEventListener("click",(e=>{n(e.target.closest(".popup"))}))})),h.editProfile.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();const t=e.target,o=t.querySelector(".popup__input_type_name"),r=t.querySelector(".popup__input_type_description");(function(e){let{name:t,about:o}=e;return fetch(`${m.baseUrl}/users/me`,{method:"PATCH",headers:m.headers,body:JSON.stringify({name:t,about:o})}).then(y)})({name:o.value,about:r.value}).then((e=>{b.textContent=e.name,g.textContent=e.about,n(h.editProfile)})).catch((e=>console.error("Ошибка обновления профиля:",e)))})),h.addCard.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();const t=e.target,r=t.querySelector(".popup__input_type_card-name"),c=t.querySelector(".popup__input_type_url");(function(e){let{name:t,link:o}=e;return fetch(`${m.baseUrl}/cards`,{method:"POST",headers:m.headers,body:JSON.stringify({name:t,link:o})}).then(y)})({name:r.value,link:c.value}).then((e=>{const r=o(e,k,L,A);S.prepend(r),function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);e.reset(),o.forEach((o=>{p(e,o,t)})),r.disabled=!0,r.classList.add(t.inactiveButtonClass)}(t,f),n(h.addCard)})).catch((e=>console.error("Ошибка добавления карточки:",e)))})),document.querySelector(".popup__confirm-button").addEventListener("click",(function(){var e;(e=E.getAttribute("data-id"),fetch(`${m.baseUrl}/cards/${e}`,{method:"DELETE",headers:m.headers}).then(y)).then((()=>{E.remove(),n(h.confirmDelete)})).catch((e=>console.error("Ошибка удаления карточки:",e)))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{!function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);i(o,r,t),o.forEach((n=>{n.addEventListener("input",(()=>{!function(e,t,o){const r=t.value.length,n=t.hasAttribute("minlength")?t.minLength:0,c=t.hasAttribute("maxlength")?t.maxLength:1e3;t.value?r<n?a(e,t,`Минимум ${n} символов. Сейчас ${r} символов.`,o):r>c?a(e,t,`Максимум ${c} символов`,o):t.validity.valid?p(e,t,o):a(e,t,t.validationMessage,o):a(e,t,"Вы пропустили это поле",o)}(e,n,t),i(o,r,t)}))}))}(t,e)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"}),Promise.all([fetch(`${m.baseUrl}/users/me`,{headers:m.headers}).then(y),fetch(`${m.baseUrl}/cards`,{headers:m.headers}).then(y)]).then((e=>{let[t,r]=e;L=t._id,b.textContent=t.name,g.textContent=t.about,C.style.backgroundImage=`url(${t.avatar})`,function(e){e.forEach((e=>{const t=o(e,k,L,A);S.append(t)}))}(r.reverse())})).catch((e=>console.error("Ошибка инициализации данных:",e)))})();