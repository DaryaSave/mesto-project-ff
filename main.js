(()=>{"use strict";var e="";function t(e,t,o,r){const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)}function o(e,t,o){const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""}function r(e,t,o){e.some((e=>!e.validity.valid||e.classList.contains(o.inputErrorClass)))?(t.classList.add(o.inactiveButtonClass),t.disabled=!0):(t.classList.remove(o.inactiveButtonClass),t.disabled=!1)}function n(e){e.querySelectorAll(".popup__input-error").forEach((e=>{e.textContent=""})),e.querySelectorAll(".popup__input").forEach((e=>{e.classList.remove("popup__input_type_error")}))}const u=document.querySelector(".popup_type_delete");u.querySelector(".popup__button_confirm"),u.querySelector(".popup__button_cancel");const c={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-36",headers:{authorization:"1edbed4a-9f7a-4d96-b1b9-f5fbaa1e4e60","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}const p=document.querySelector("#card-template")?.content;function i(e,t,o,r,n){if(!p)return;const u=p.cloneNode(!0).querySelector(".card"),c=u.querySelector(".card__image"),a=u.querySelector(".card__title"),i=u.querySelector(".card__delete-button"),s=u.querySelector(".card__like-button");return c.src=e.link,c.alt=e.name,a.textContent=e.name,e.owner._id!==n?i.style.display="none":i.addEventListener("click",(()=>r(u,e._id,e.owner._id,n))),s.addEventListener("click",(()=>o(s))),c.addEventListener("click",(()=>t(e))),u}function s(e){e&&!e.classList.contains("popup_is-opened")&&(e.classList.add("popup_is-opened"),document.addEventListener("keydown",d))}function l(e){e&&e.classList.contains("popup_is-opened")&&(e.classList.add("popup_fade-out"),requestAnimationFrame((()=>{setTimeout((()=>{e.classList.remove("popup_is-opened","popup_fade-out"),document.removeEventListener("keydown",d)}),300)})))}function d(e){const t=document.querySelector(".popup_is-opened");"Escape"===e.key&&t&&l(t)}function _(e){e.target.classList.contains("popup")&&l(e.target)}const m=e+"images/logo.svg",y=e+"images/avatar.jpg";document.querySelector(".header__logo").src=m,document.querySelector(".profile__image").style.backgroundImage=`url(${y})`;const f={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},S=document.querySelector(".places__list"),h={addCard:document.querySelector(".popup_type_new-card"),editProfile:document.querySelector(".popup_type_edit"),image:document.querySelector(".popup_type_image")},v=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),b=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),g=document.querySelector(".profile__image");let L;function E(e){const t=h.image.querySelector(".popup__image"),o=h.image.querySelector(".popup__caption");t.src=e.link,t.alt=e.name,o.textContent=e.name,s(h.image)}v?.addEventListener("click",(()=>{const e=h.editProfile.querySelector(".popup__form"),t=e.querySelector(".popup__input_type_name"),o=e.querySelector(".popup__input_type_description");t.value=b.textContent,o.value=C.textContent,n(e),s(h.editProfile)})),q?.addEventListener("click",(()=>{const e=h.addCard.querySelector(".popup__form");e.reset(),n(e),s(h.addCard)})),document.querySelectorAll(".popup").forEach((e=>{e.addEventListener("click",_)})),document.querySelectorAll(".popup__close").forEach((e=>{e.addEventListener("click",(e=>{l(e.target.closest(".popup"))}))})),h.editProfile.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();const t=e.target,o=t.querySelector(".popup__input_type_name"),r=t.querySelector(".popup__input_type_description");(function(e){let{name:t,about:o}=e;return fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:o})}).then(a)})({name:o.value,about:r.value}).then((e=>{b.textContent=e.name,C.textContent=e.about,l(h.editProfile)})).catch((e=>console.error("Ошибка обновления профиля:",e)))})),h.addCard.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();const t=e.target,r=t.querySelector(".popup__input_type_card-name"),n=t.querySelector(".popup__input_type_url");(function(e){let{name:t,link:o}=e;return fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:t,link:o})}).then(a)})({name:r.value,link:n.value}).then((e=>{const r=i(e,E,L);S.prepend(r),function(e,t){const r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);e.reset(),r.forEach((r=>{o(e,r,t)})),n.disabled=!0,n.classList.add(t.inactiveButtonClass)}(t,f),l(h.addCard)})).catch((e=>console.error("Ошибка добавления карточки:",e)))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((n=>{!function(e,n){const u=Array.from(e.querySelectorAll(n.inputSelector)),c=e.querySelector(n.submitButtonSelector);r(u,c,n),u.forEach((a=>{a.addEventListener("input",(()=>{!function(e,r,n){const u=r.value.length,c=r.hasAttribute("minlength")?r.minLength:0,a=r.hasAttribute("maxlength")?r.maxLength:1e3;r.value?u<c?t(e,r,`Минимум ${c} символов. Сейчас ${u} символов.`,n):u>a?t(e,r,`Максимум ${a} символов`,n):r.validity.valid?o(e,r,n):t(e,r,r.validationMessage,n):t(e,r,"Вы пропустили это поле",n)}(e,a,n),r(u,c,n)}))}))}(n,e)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"}),Promise.all([fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(a),fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(a)]).then((e=>{let[t,o]=e;L=t._id,b.textContent=t.name,C.textContent=t.about,g.style.backgroundImage=`url(${t.avatar})`,function(e){e.forEach((e=>{const t=i(e,E,handleLikeClick,handleDeleteClick,undefined);S.append(t)}))}(o.reverse())})).catch((e=>console.error("Ошибка инициализации данных:",e)))})();